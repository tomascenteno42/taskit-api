# Migration `20200712161934-create-invitation`

This migration has been generated by Teodoro Villanueva at 7/12/2020, 4:19:34 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Task" DROP CONSTRAINT "Task_board_id_fkey"

CREATE TABLE "public"."Invitation" (
"boardId" integer  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL ,
"id" SERIAL,
"updatedAt" timestamp(3)   ,
"userId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Task" DROP COLUMN "board_id",
ADD COLUMN "boardId" integer  NOT NULL ;

CREATE UNIQUE INDEX "Invitation.boardId_userId" ON "public"."Invitation"("boardId","userId")

ALTER TABLE "public"."Invitation" ADD FOREIGN KEY ("boardId")REFERENCES "public"."Board"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Invitation" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Task" ADD FOREIGN KEY ("boardId")REFERENCES "public"."Board"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200712161507-add-subscribed-boards..20200712161934-create-invitation
--- datamodel.dml
+++ datamodel.dml
@@ -1,34 +1,36 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
 model User {
-  id                Int     @id @default(autoincrement())
+  id                Int          @id @default(autoincrement())
   name              String
-  email             String  @unique
+  email             String       @unique
   password          String
-  subscribed_boards Board[] @relation(name: "BoardToUser")
-  boards            Board[] @relation(name: "BoardToAuthor")
+  subscribed_boards Board[]      @relation(name: "BoardToUser")
+  boards            Board[]      @relation(name: "BoardToAuthor")
   tasks             Task[]
-  createdAt DateTime
-  updatedAt DateTime?
+  invitations       Invitation[]
+  createdAt         DateTime
+  updatedAt         DateTime?
 }
 model Board {
-  id        Int       @id @default(autoincrement())
-  name      String
-  authorId  Int
-  author    User      @relation(name: "BoardToAuthor",fields: [authorId], references: [id])
-  tasks     Task[]
-  users     User[]    @relation(name: "BoardToUser")
-  createdAt DateTime
-  updatedAt DateTime?
+  id          Int          @id @default(autoincrement())
+  name        String
+  authorId    Int
+  author      User         @relation(name: "BoardToAuthor", fields: [authorId], references: [id])
+  tasks       Task[]
+  users       User[]       @relation(name: "BoardToUser")
+  invitations Invitation[]
+  createdAt   DateTime
+  updatedAt   DateTime?
 }
 enum TaskStatus {
   COMPLETED
@@ -41,9 +43,21 @@
   content   String
   status    TaskStatus
   authorId  Int
   author    User       @relation(fields: [authorId], references: [id])
-  board_id  Int
-  board     Board      @relation(fields: [board_id], references: [id])
+  boardId   Int
+  board     Board      @relation(fields: [boardId], references: [id])
   createdAt DateTime
   updatedAt DateTime?
 }
+
+model Invitation {
+  id      Int   @default(autoincrement()) @id
+  boardId Int
+  userId  Int
+  board   Board @relation(fields: [boardId], references: [id])
+  user    User  @relation(fields: [userId], references: [id])
+  createdAt DateTime
+  updatedAt DateTime?
+
+  @@unique([boardId, userId])
+}
```


